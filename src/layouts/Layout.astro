<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<title>Comsatel</title>
	</head>
	<body>
		<header class="dashboard-header">
			<picture class="home-icon-container">
				<img src="../assets/icons/icon-home-filled.svg" class="home-icon">
			</picture>
			<!-- Home icon moved to sidebar -->
			<div class="user-profile" id="userProfileBtn">
				<div class="user-info">
					<img src="../assets/icons/icon-user.svg" alt="User" class="user-icon">
					<span>Kevin Briones</span>
				</div>
				<img src="../assets/icons/icon-arrow-down.svg" alt="More" class="arrow-icon" id="arrowIcon">
			</div>
			<!-- User Menu Overlay -->
			<div class="user-menu-container" id="userMenu">
				<div class="user-menu-row">
					<p>Correo: <span id="company-email">correo@mail.com</span></p>
					<p>Nombre de Empresa: <span id="company-name">Nivek</span></p>
					<a href="change_password_internal.html" class="menu-link">Cambio de clave</a>
					<button class="menu-link-btn" id="logoutBtn">Cerrar Sesión</button>
				</div>
			</div>
		</header>
		<slot />
	</body>
	<footer class="dashboard-footer">
		<img src="../assets/imgs/logo-white.svg" alt="Comsatel Logo" class="footer-logo">
		<span class="footer-text">COMSATEL</span>
	</footer>
</html>

<script>
    const userProfileBtn = document.getElementById('userProfileBtn');
    const userMenu = document.getElementById('userMenu');
    const arrowIcon = document.getElementById('arrowIcon');
    const logoutBtn = document.getElementById('logoutBtn');
    
    // Función auxiliar para cerrar el menú
    const closeMenu = () => {
        userMenu?.classList.remove('show-menu');
        arrowIcon?.classList.remove('flip');
    };

    // 1. ABRIR / CERRAR AL DAR CLICK AL BOTÓN DE PERFIL
    userProfileBtn?.addEventListener('click', (e) => {
        // Evitamos que este click se propague al document (que cerraría el menú inmediatamente)
        e.stopPropagation(); 
        userMenu?.classList.toggle('show-menu');
        arrowIcon?.classList.toggle('flip');
    });

    // 2. CERRAR AL DAR CLICK EN CUALQUIER PARTE FUERA DEL MENÚ
    document.addEventListener('click', (e) => {
        // Si el menú está abierto Y el click NO fue dentro del menú
        if (userMenu?.classList.contains('show-menu') && !userMenu.contains(e.target as Node)) {
            closeMenu();
        }
    });

    // 3. CERRAR AL DAR CLICK EN UNA OPCIÓN DEL MENÚ
    // Seleccionamos todos los enlaces o botones dentro del menú
    const menuLinks = userMenu?.querySelectorAll('a, button');
    
    menuLinks?.forEach(link => {
        link.addEventListener('click', () => {
            // Si es el botón de logout, ejecutamos su lógica específica primero
            if (link.id === 'logoutBtn') return; 
            
            closeMenu();
        });
    });

    function logout() {
        // Tu lógica de logout existente
        localStorage.removeItem('usuarioLogueado');
        window.location.href = '/';
    }

    logoutBtn?.addEventListener('click', logout);
</script>

<style is:global>
	@font-face {
		font-family: 'Muli';
		src: url('../assets/fonts/Muli-Regular.ttf') format('truetype');
		font-weight: 400;
		font-style: normal;
	}

	@font-face {
		font-family: 'Muli';
		src: url('../assets/fonts/Muli-Bold.ttf') format('truetype');
		font-weight: 700;
		font-style: normal;
	}

	@font-face {
		font-family: 'Muli';
		src: url('../assets/fonts/Muli-ExtraLight.ttf') format('truetype');
		font-weight: 200;
		font-style: normal;
	}

	:root {
		/* Blancos */
		--blanco-total: #ffffff;
		--blanco-08: rgba(255, 255, 255, 0.8);
		--blanco-06: rgba(255, 255, 255, 0.6);
		--blanco-04: rgba(255, 255, 255, 0.4);
		--blanco-02: rgba(255, 255, 255, 0.2);
		--blanco-016: rgba(255, 255, 255, 0.16);
		--blanco-006: rgba(255, 255, 255, 0.06);
		--blanco-004: rgba(255, 255, 255, 0.04);

		/* Azules Primarios (22, 33, 62) */
		--azul-primario-total: rgb(22, 33, 62);
		--azul-primario-096: rgba(22, 33, 62, 0.96);
		--azul-primario-08: rgba(22, 33, 62, 0.8);
		--azul-primario-06: rgba(22, 33, 62, 0.6);
		--azul-primario-04: rgba(22, 33, 62, 0.4);

		/* Otros Azules */
		--azul-oscuro: #1c2e4a;
		--azul-medio: #3a506b;
		--azul-grisaceo: #2b3d55;
		--azul-profundo: rgba(0, 15, 35, 1);
		--azul-acero-10: rgb(68, 96, 117);
		--azul-noche-10: rgb(10, 25, 47);
		--azul-noche-04: rgba(10, 25, 47, 0.4);

		/* Cyan */
		--cyan-neon: #00d2ff;
		--cyan-neon-06: rgba(0, 210, 255, 0.6);
		--cyan-neon-02: rgba(0, 210, 255, 0.2);
		--cyan-hover: #00b8e6;
		--cyan-neon-00: rgba(0, 210, 255, 0);

		/* Negro/Sombras */
		--negro-06: rgba(0, 0, 0, 0.6);
		--negro-04: rgba(0, 0, 0, 0.4);
		--negro-02: rgba(0, 0, 0, 0.2);

		/* Estados */
		--estado-activo: #4CAF50;
		--estado-finalizando: #FF9800;
		--estado-inactivo: #F44336;
		--gris-texto: #555;

		/* Variables Legacy (Mapeadas a las nuevas) */
		--bg-white: var(--blanco-total);
		--primary-gradient: linear-gradient(180deg, var(--azul-medio) 0%, var(--azul-oscuro) 100%);
		--accent-cyan: var(--cyan-neon);
		--text-white: var(--blanco-total);
		--input-border: var(--blanco-08);
	}

	* {
		box-sizing: border-box;
		margin: 0;
		padding: 0;
	}
	html,
	body {
		width: 100%;
		height: 100%;
		background-image: url(assets/imgs/bg.avif);
		background-size: cover;
		background-position: center;
		background-repeat: no-repeat;
		font-family: Muli;
		overflow: hidden;
	}

	.dashboard-header {
		display: grid;
		width: 90%;
		margin: 1rem auto 0;
		gap: 1rem;
		grid-template-columns: 3.5rem 1fr;
		grid-template-rows: 3.5rem 3.5rem;
		color: var(--blanco-total);
	}
	.home-icon-container {
		width: 3.5rem;
		height: 3.5rem;
		margin: 0 auto;
	}
	.home-icon {
		width: 100%;
    	padding: .75rem;
		cursor: pointer;
	}
	.user-profile {
		display: flex;
		justify-content: space-between;
		align-items: center;
		border: 1px solid var(--blanco-total);
		border-radius: 12px;
		height: 3.5rem;
	}
	.user-info {
		height: 100%;
		display: flex;
    	align-items: center;
	}
	.user-icon {
		height: 100%;
		padding: .5rem;
	}
	.arrow-icon {
		height: 100%;
		padding: .75rem;
		cursor: pointer;
		transition: transform .3s ease-in-out;
		transform: rotate(0deg);
	}

	.flip {
		transform: rotate(180deg);
	}

	.user-menu-container {
        display: flex; 
        
        height: fit-content;
        width: 100%;
        grid-column: 2 / 3;
        border: 1px solid var(--blanco-total);
        border-radius: 12px;
        padding: 1rem;
        background-color: var(--azul-primario-096);
        backdrop-filter: blur(5px);
        
        /* CAMBIOS PARA ANIMACIÓN */
        visibility: hidden;
        opacity: 0; 
        transform: translateY(-10px);
        transition: all 0.3s ease-in-out;
        position: relative; 
        z-index: 10;
    }

    .show-menu {
        /* CAMBIOS PARA MOSTRAR */
        visibility: visible;
        opacity: 1;
        transform: translateY(0);
    }

	.user-menu-row {
		font-size: 14px;
		width: 100%;
		font-weight: 600;
		display: flex;
		flex-wrap: wrap;
		justify-content: space-between;
		gap: .75rem;

		p {
			display: flex;
			gap: .5rem;
		}
	}

	.menu-link, .menu-link-btn {
		cursor: pointer;
		color: var(--blanco-total);
		font-weight: 400;
		transition: color .3s ease-in-out;
		text-decoration: none;
	}

	.menu-link:hover, .menu-link-btn:hover {
		color: var(--cyan-hover);
	}
	.menu-link-btn {
		background: none;
		border: none;
	}
	#company-email, #company-name {
		font-weight: 300;
	}
	.dashboard-footer {
		width: 100%;
		height: 5rem;
		display: flex;
		justify-content: space-between;
		align-items: center;
		position: absolute;
		padding: 1rem 1.5rem;
		bottom: 0rem;
		color: var(--blanco-total);

		.footer-logo {
			height: 100%;
		}
		.footer-text {
			font-size: .75rem;
			font-weight: 600;
			letter-spacing: 1px;
		}
	}
</style>
